var loopResolution=384,loopDeltaPh=2*Math.PI/loopResolution,camRadius=4,dashLength=.1,sphereAlpha=.5,sphereSubdivisions=8,Mask;(function(a){a[a.Invisible=0]="Invisible";a[a.Left=1]="Left";a[a.Right=2]="Right"})(Mask||(Mask={}));
var unitVecToFibre=function(a,b){var c=Math.sqrt(.5*(1+a.z)),d=-Math.sqrt(.5*(1-a.z)),f=Math.atan2(-a.x,a.y)-b,e=c*Math.cos(f);e=Math.acos(e)/(Math.PI*Math.sqrt(1-Math.pow(e,2)));return new BABYLON.Vector3(d*Math.cos(b)*e,d*Math.sin(b)*e,c*Math.sin(f)*e)},pointToColor=function(a){return new BABYLON.Color4(.5*(1-a.x),.5*(1-a.y),.5*(1-a.z),1)},createPath=function(a){for(var b=[],c=0,d=0;d<=loopResolution;d++)b.push(unitVecToFibre(a,c)),c+=loopDeltaPh;return b},createLoop=function(a,b,c){var d=createPath(a);
a=pointToColor(a);a=Array(d.length).fill(a);b=BABYLON.MeshBuilder.CreateLines("lines",{points:d,useVertexAlpha:!1,colors:a},b);b.layerMask=c;b.isPickable=!1;return b},createCamera=function(a,b,c){a=new BABYLON.ArcRotateCamera(a,0,0,camRadius,BABYLON.Vector3.Zero(),c);a.viewport=b===Mask.Left?new BABYLON.Viewport(0,0,.5,1):new BABYLON.Viewport(.5,0,.5,1);a.layerMask=b;a.noRotationConstraint=!0;a.lowerRadiusLimit=a.upperRadiusLimit=a.radius=camRadius;a.panningAxis=BABYLON.Vector3.Zero();a.angularSensibilityX*=
-1;a.angularSensibilityY*=-1;return a},createDash=function(a,b,c){var d=[a.scale(1-dashLength),a.scale(1+dashLength)];a=pointToColor(a);b=BABYLON.MeshBuilder.CreateLines("dash",{points:d,colors:[a,a],useVertexAlpha:!1},b);b.layerMask=c;return b},createSphere=function(a){var b=createCamera("leftCamera",Mask.Left,a);b.attachControl(canvas,!0);a.activeCameras.push(b);b=new BABYLON.StandardMaterial("material",a);b.alpha=sphereAlpha;b.emissiveColor=BABYLON.Color3.White();a=BABYLON.MeshBuilder.CreateIcoSphere("sphere",
{subdivisions:sphereSubdivisions,flat:!1},a);a.material=b;a.layerMask=Mask.Left;return a},draw=function(a){createDash(a,scene,Mask.Left);createLoop(a,scene,Mask.Right)},createScene=function(){var a=new BABYLON.Scene(engine);a.clearColor=new BABYLON.Color4(0,0,0,1);var b=createCamera("rightCamera",Mask.Right,a);b.attachControl(canvas,!0);a.activeCameras.push(b);var c=createSphere(a),d=!1;a.onPointerObservable.add(function(b){var e=a.pick(a.pointerX,a.pointerY,function(a){return a===c});switch(b.type){case BABYLON.PointerEventTypes.POINTERUP:d=
!1;break;case BABYLON.PointerEventTypes.POINTERDOWN:d=!0;case BABYLON.PointerEventTypes.POINTERMOVE:e&&e.pickedMesh===c&&d&&e.pickedPoint&&draw(e.pickedPoint)}});return a},canvas=document.getElementById("renderCanvas"),engine=new BABYLON.Engine(canvas,!0),scene=createScene();engine.runRenderLoop(function(){scene.render()});window.addEventListener("resize",function(){engine.resize()});